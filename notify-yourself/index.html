<!DOCTYPE html>
 <html lang="en" amp=""><head><style amp-boilerplate="">body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate="">body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom="">html,body{font:13px Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace, serif;margin:0}.logo{padding:2rem 3rem 1rem 3rem}a{text-decoration:none;color:#4DB6AC}h2,h3,h4{color:#4DB6AC}h4{font-weight:500}.app{padding:0rem 3rem 1rem 3rem}.flex{margin:auto;max-width:650px;padding:0 3rem}#instagram{font-size:2rem}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;line-height:1.75rem;color:rgba(0,0,0,0.59);font-style:italic;border-left:0.32813rem solid rgba(0,0,0,0.9)}img{max-width:100%}@media only screen and (max-width: 500px){.flex{padding:0 0 0 0}.app .logo{padding-left:0}.app{padding:0rem 2rem 1rem 2rem}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;line-height:1.75rem;color:rgba(0,0,0,0.59);font-style:italic;border-left:0.32813rem solid rgba(0,0,0,0.9)}}.markdown pre{display:block;background:#3F3F3F;color:#DCDCDC;overflow-y:hidden}.markdown pre code{background:none;border:none;border-radius:3px;display:inline-block;overflow:inherit;padding:1.58333rem;white-space:inherit;word-wrap:normal}code{white-space:pre;white-space:pre-wrap;white-space:pre-line;white-space:-pre-wrap;white-space:-o-pre-wrap;white-space:-moz-pre-wrap;white-space:-hp-pre-wrap;word-wrap:break-word;background:#E0F7FA;display:inline;font-family:Inconsolata, monospace, serif;max-width:100%;overflow:auto;padding:0 0.1625rem}.hljs-keyword,.hljs-tag,.css .hljs-class,.css .hljs-id,.lisp .hljs-title,.nginx .hljs-title,.hljs-request,.hljs-status,.clojure .hljs-attribute{color:#E3CEAB}.django .hljs-template_tag,.django .hljs-variable,.django .hljs-filter .hljs-argument{color:#DCDCDC}.hljs-number,.hljs-date{color:#8CD0D3}.dos .hljs-envvar,.dos .hljs-stream,.hljs-variable,.apache .hljs-sqbracket{color:#EFDCBC}.dos .hljs-flow,.diff .hljs-change,.python .exception,.python .hljs-built_in,.hljs-literal,.tex .hljs-special{color:#EFEFAF}.diff .hljs-chunk,.hljs-subst{color:#8F8F8F}.dos .hljs-keyword,.python .hljs-decorator,.hljs-title,.haskell .hljs-type,.diff .hljs-header,.ruby .hljs-class .hljs-parent,.apache .hljs-tag,.nginx .hljs-built_in,.tex .hljs-command,.hljs-prompt{color:#efef8f}.dos .hljs-winutils,.ruby .hljs-symbol,.ruby .hljs-symbol .hljs-string,.ruby .hljs-string{color:#DCA3A3}.diff .hljs-deletion,.hljs-string,.hljs-tag .hljs-value,.hljs-preprocessor,.hljs-pragma,.hljs-built_in,.sql .hljs-aggregate,.hljs-javadoc,.smalltalk .hljs-class,.smalltalk .hljs-localvars,.smalltalk .hljs-array,.css .hljs-rules .hljs-value,.hljs-attr_selector,.hljs-pseudo,.apache .hljs-cbracket,.tex .hljs-formula,.coffeescript .hljs-attribute{color:#CC9393}.hljs-shebang,.diff .hljs-addition,.hljs-comment,.java .hljs-annotation,.hljs-template_comment,.hljs-pi,.hljs-doctype{color:#7F9F7F}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .javascript,.xml .vbscript,.xml .css,.xml .hljs-cdata{opacity:0.5}
body,html{font:13px Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;margin:0}.logo{padding:2rem 3rem 1rem}a{text-decoration:none}a,h2,h3,h4{color:#4db6ac}h4{font-weight:500}.app{padding:0 3rem 1rem}.flex{margin:auto;max-width:650px;padding:0 3rem}#instagram{font-size:2rem}blockquote{margin:0 1.75rem 1.75rem -1.75rem;padding:0 0 0 1.42188rem;line-height:1.75rem;color:rgba(0,0,0,.59);font-style:italic;border-left:.32813rem solid rgba(0,0,0,.9)}img{max-width:100%}@media only screen and (max-width:500px){.flex{padding:0}.app .logo{padding-left:0}.app{padding:0 2rem 1rem}blockquote{margin:0 1.75rem 1.75rem -1.75rem;padding:0 0 0 1rem;line-height:1.75rem;color:rgba(0,0,0,.59);font-style:italic;border-left:.32813rem solid rgba(0,0,0,.9)}}.markdown pre{display:block;background:#3f3f3f;color:#dcdcdc;overflow-y:hidden}.markdown pre code{background:none;border:none;border-radius:3px;display:inline-block;overflow:inherit;padding:1.58333rem;white-space:inherit;word-wrap:normal}code{white-space:pre;white-space:pre-wrap;white-space:pre-line;white-space:-pre-wrap;white-space:-o-pre-wrap;white-space:-moz-pre-wrap;white-space:-hp-pre-wrap;word-wrap:break-word;background:#e0f7fa;display:inline;font-family:Inconsolata,monospace,serif;max-width:100%;overflow:auto;padding:0 .1625rem}.clojure .hljs-attribute,.css .hljs-class,.css .hljs-id,.hljs-keyword,.hljs-request,.hljs-status,.hljs-tag,.lisp .hljs-title,.nginx .hljs-title{color:#e3ceab}.django .hljs-filter .hljs-argument,.django .hljs-template_tag,.django .hljs-variable{color:#dcdcdc}.hljs-date,.hljs-number{color:#8cd0d3}.apache .hljs-sqbracket,.dos .hljs-envvar,.dos .hljs-stream,.hljs-variable{color:#efdcbc}.diff .hljs-change,.dos .hljs-flow,.hljs-literal,.python .exception,.python .hljs-built_in,.tex .hljs-special{color:#efefaf}.diff .hljs-chunk,.hljs-subst{color:#8f8f8f}.apache .hljs-tag,.diff .hljs-header,.dos .hljs-keyword,.haskell .hljs-type,.hljs-prompt,.hljs-title,.nginx .hljs-built_in,.python .hljs-decorator,.ruby .hljs-class .hljs-parent,.tex .hljs-command{color:#efef8f}.dos .hljs-winutils,.ruby .hljs-string,.ruby .hljs-symbol,.ruby .hljs-symbol .hljs-string{color:#dca3a3}.apache .hljs-cbracket,.coffeescript .hljs-attribute,.css .hljs-rules .hljs-value,.diff .hljs-deletion,.hljs-attr_selector,.hljs-built_in,.hljs-javadoc,.hljs-pragma,.hljs-preprocessor,.hljs-pseudo,.hljs-string,.hljs-tag .hljs-value,.smalltalk .hljs-array,.smalltalk .hljs-class,.smalltalk .hljs-localvars,.sql .hljs-aggregate,.tex .hljs-formula{color:#cc9393}.diff .hljs-addition,.hljs-comment,.hljs-doctype,.hljs-pi,.hljs-shebang,.hljs-template_comment,.java .hljs-annotation{color:#7f9f7f}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .css,.xml .hljs-cdata,.xml .javascript,.xml .vbscript{opacity:.5}</style><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title data-react-helmet="true">Notify yourself | Ulises Giacoman</title><link rel="canonical" href="/notify-yourself/"><script async src="https://cdn.ampproject.org/v0.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"></head><body><div id="react-mount"><div class="app" data-reactroot="" data-reactid="1" data-react-checksum="418032968"><div class="logo" data-reactid="2"><a href="/" data-reactid="3">land of dev</a></div><div class="flex" data-reactid="4"><h3 data-reactid="5"><a href="/" data-reactid="6">Ulises Giacoman</a></h3><div class="markdown" data-reactid="7"><!-- react-empty: 8 --><h1 data-reactid="9">Notify yourself</h1><div data-reactid="10"><p>Notifications are everywhere and you’re probably ignoring most of them.
What if we could control our notifications? Instead of subscribing to the blanket that is the
internet, we instead plug in our own observers that will notify us about the events that matter.</p>
<p>If you use Slack, then you probably have used a slack integration. Integrations can be incredibly robust
because of Slack’s open API. We are going to focus on creating personalized notifications through Slack.
Notifications that you can enable/disable when you don’t need them. Best of all, it won’t
cost you a dime. The Slack API lets us send messages to channels and users. Combine their API with your smartphone,
and you’ll be sending yourself push notifications for</p>
<h2>Let’s get to it.</h2>
<p>In our case, we will be sending ourselves a push notification everytime someone visits our website.</p>
<h3>Creating a Slack Integration</h3>
<p>You’ll want a Slack where you have access to adding integrations.</p>
<ol>
<li>Find your slack domain i.e. <code>https://slackers.slack.com/</code>. Where <code>slackers</code> is your team name.</li>
<li>Navigate to your team’s apps and integrations. In general, Slack will host this page at <code>/apps/build</code>
i.e. <code>https://slackers.slack.com/apps/build</code></li>
<li>From here we’ll want to make a <code>custom integration</code> and then select <code>Incoming WebHooks</code>.</li>
<li>By this step you’ll know whether you have access to creating integrations on your team.</li>
<li>Confirm by selecting a default channel you’d like to post to (doesn’t really matter, you’ll be able to post to any). I chose: <code>Privately to myself</code>.</li>
</ol>
<amp-img src="//i.imgur.com/19Ev5bl.png" alt="Slack Integration Confirmation" width="1940" height="605"></amp-img>
<p>Webhooks are exactly what they sound like, a hook on the web. They’re little Captain Hooks that will do
your bidding, when they are called to action. In this case they will intercept our custom message and
post it in our channel.</p>
<h3>Creating our API</h3>
<p>Now that you have created a custom integration, you’ll need the Webhook URL to be able to post to your team’s Slack.
With that URL, you’ll be able to send <code>POST</code> requests with directions on where to deliver your payload. This is nice,
but if anyone get’s your Webhook URL, they’ll be able to post anywhere on your team’s slack. So let’s add a level of
security, by wrapping it in our own API. This way, we’ll be able to use our API on front end clients. If people
do abuse your API, they’ll abuse only to the level you’ve let them.</p>
<p>You can find the codebase for the API <a href="https://github.com/ugiacoman/notification-api/blob/master/index.js">here</a>.
Full instructions on how to deploy using Heroku can be found in the <code>README.md</code>. Below, I will explain the codebase.</p>
<h4>Micro + Heroku</h4>
<p>We’ll use two tools to create and host our API: Micro + Heroku. Micro will allow us to create a minamalist
API (micro-service), without any overhead. Heroku lets us deploy effortlessly and gives us a server where we can host our API.
When using Heroku free tier, your API will go to sleep during inactivity. However, this is ok because the request will still go through.
Keep this in mind if you need realtime notifications. If your API goes to sleep, the first request will be slow to respond, but then will
behave normally.</p>
<h4>The Wrapper</h4>
<p>Our API will wrap the Slack Webhook. We’ll open access to the username, user icon, and message. We’ll hardcode the channel so that your Slack team doesn’t
get spammed. Now we want to simplify access to the Slack API, so we’ll be creating a <code>GET</code> endpoint and use URL query parameters to configure our messages.
Let’s start off by parsing the query into our payload object. We’ll parse the query using <code>url</code> and use environment variables (<code>process.env.CHANNEL</code>)
to set the channel to which to post to. Remember this can be a channel (<code>#general</code>) or a user (<code>@uli</code>). We are setting these variables in our <code>.env</code> file.</p>
<pre><code class="language-env"><span class="hljs-comment"># .env</span>

<span class="hljs-attr">SLACK_URL</span>=https://hooks.slack.com/services/blahblahblacksheep
<span class="hljs-attr">CHANNEL</span>=#general
</code></pre>
<pre><code class="language-js"><span class="hljs-comment">// index.js</span>

<span class="hljs-keyword">const</span> { parse } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>)
<span class="hljs-built_in">require</span>(<span class="hljs-string">'dotenv'</span>).config()

<span class="hljs-keyword">const</span> { query } = parse(request.url, <span class="hljs-literal">true</span>)

<span class="hljs-keyword">var</span> payload = { <span class="hljs-string">'channel'</span>: process.env.CHANNEL,
                <span class="hljs-string">'username'</span>: query.username,
                <span class="hljs-string">'text'</span>: query.text,
                <span class="hljs-string">'icon_emoji'</span>: <span class="hljs-string">':'</span> + query.emoji + <span class="hljs-string">':'</span>
                }
</code></pre>
<h4>Sending our request</h4>
<p>Our Slack Webhook accepts <code>form-urlencoded</code> parameters. These parameters are of key-value type, specifically it expects a parameter <code>payload</code> with
the value of a <code>JSON</code> object. This object contains our message options (channel, username, etc…).
We’ll use <code>isomorphic-fetch</code> to send our <code>GET</code> request to our API. We are using <code>await</code> to not block up the main thread and making this request asynchronous.
Our <code>await</code>, will wait for the <code>promise</code> to go through. Promises capture the idea that we’ll eventually get value back and that it might not be immediately.
Then we’ll store the response and return it. In our case, the response will let us know if there is an error in posting to Slack.</p>
<pre><code class="language-js"><span class="hljs-comment">// index.js</span>

<span class="hljs-keyword">const</span> fetch = <span class="hljs-built_in">require</span>(<span class="hljs-string">'isomorphic-fetch'</span>)

<span class="hljs-keyword">const</span> formBody = [<span class="hljs-string">'payload='</span> + <span class="hljs-built_in">JSON</span>.stringify(payload)]

<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> fetch(process.env.SLACK_URL, {
                            <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
                            <span class="hljs-attr">headers</span>: {
                              <span class="hljs-string">"cache-control"</span>: <span class="hljs-string">"no-cache"</span>,
                              <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/x-www-form-urlencoded"</span>
                            },    
                            <span class="hljs-attr">body</span>: formBody
                            })
                            .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                              <span class="hljs-keyword">return</span> response.text()
                            }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
                              <span class="hljs-keyword">return</span> <span class="hljs-string">'Couldn\'t reach slack, check if you configured your .env file correctly.'</span>
                            })
<span class="hljs-keyword">return</span> response
</code></pre>
<h4>Exporting and Usage</h4>
<p>Our full API, we didn’t cover <code>module.exports</code>. By exporting, we are telling <code>micro</code> to use this code as our endpoint.</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> { parse } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>)
<span class="hljs-keyword">const</span> fetch = <span class="hljs-built_in">require</span>(<span class="hljs-string">'isomorphic-fetch'</span>)
<span class="hljs-built_in">require</span>(<span class="hljs-string">'dotenv'</span>).config()

<span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">async</span> request =&gt; {
  <span class="hljs-keyword">const</span> { query } = parse(request.url, <span class="hljs-literal">true</span>)

  <span class="hljs-keyword">var</span> payload = { <span class="hljs-string">'channel'</span>: process.env.CHANNEL,
                    <span class="hljs-string">'username'</span>: query.username,
                    <span class="hljs-string">'text'</span>: query.text,
                    <span class="hljs-string">'icon_emoji'</span>: <span class="hljs-string">':'</span> + query.emoji + <span class="hljs-string">':'</span>
                  }
  <span class="hljs-keyword">const</span> formBody = [<span class="hljs-string">'payload='</span> + <span class="hljs-built_in">JSON</span>.stringify(payload)]

  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> fetch(process.env.SLACK_URL, {
                                <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
                                <span class="hljs-attr">headers</span>: {
                                  <span class="hljs-string">"cache-control"</span>: <span class="hljs-string">"no-cache"</span>,
                                  <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/x-www-form-urlencoded"</span>
                                },    
                                <span class="hljs-attr">body</span>: formBody
                                })
                              .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                                <span class="hljs-keyword">return</span> response.text()
                              }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
                                <span class="hljs-keyword">return</span> <span class="hljs-string">'Couldn\'t reach slack, check if you configured your .env file correctly.'</span>
                              })
  <span class="hljs-keyword">return</span> response


</code></pre>
<p>We can now post messages to your Slack by simply hitting our endpoint, i.e. <code>//host.com/?username=Uli%20bot&amp;text=hiya%20people&amp;emoji=partyparrot</code>.</p>
<h3>Use Cases</h3>
<p>Now you can embed this request into any page, such as your personal website, and you’ll get notified! Make sure you have Slack push notifications enabled :)</p>
<p>Stay tuned for building minimal iOS crash reporting by using our micro-service above.</p>
</div><em data-reactid="11"><!-- react-text: 12 -->Posted <!-- /react-text --><!-- react-text: 13 -->January 26, 2017<!-- /react-text --></em><hr data-reactid="14"><noscript data-reactid="15"></noscript><div data-reactid="16"><p data-reactid="17"><strong data-reactid="18">Uli</strong><!-- react-text: 19 --> likes to build in the land of dev. Follow on <!-- /react-text --><a id="instagram" href="https://www.instagram.com/ulisantosg/" target="_blank" data-reactid="20"><svg fill="currentColor" preserveaspectratio="xMidYMid meet" height="1em" width="1em" viewbox="0 0 40 40" data-reactid="21"><g data-reactid="22"><path d="m30 5h-20c-2.8 0-5 2.2-5 5v20c0 2.8 2.2 5 5 5h20c2.8 0 5-2.2 5-5v-20c0-2.8-2.2-5-5-5z m-10 10c2.8 0 5 2.2 5 5s-2.2 5-5 5-5-2.2-5-5 2.2-5 5-5z m6.3-3.3c0-1.2 1-2 2-2s2 1 2 2-0.8 2-2 2-2-0.9-2-2z m3.7 20h-20c-1 0-1.7-0.7-1.7-1.7v-10h3.4c0 4.7 3.6 8.3 8.3 8.3s8.3-3.6 8.3-8.3h3.4v10c0 1-0.7 1.7-1.7 1.7z" data-reactid="23"/></g></svg></a></p><p data-reactid="24">Projects | Github</p></div></div></div></div></div></body></html>